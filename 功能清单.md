# Photo Watermark 2 - 功能清单与使用指南

## 📋 目录
- [最新更新](#最新更新)
- [已实现功能](#已实现功能)
- [拖拽导入](#拖拽导入)
- [字体系统](#字体系统)
- [水印位置拖拽](#水印位置拖拽)
- [颜色选择](#颜色选择)
- [使用指南](#使用指南)

---

## 🆕 最新更新

### 架构重构（使用OpenCV实现图片水印）

**水印管理模块分离**：
- `text_watermark_manager.py` - 文本水印管理（基于PIL）
- `image_watermark_manager.py` - 图片水印管理（基于OpenCV）
- 原有的 `watermark_manager.py` 已不再使用

**新增依赖**：
```bash
pip install opencv-python numpy
```
或使用：
```bash
pip install -r requirements.txt
```

### 功能改进

#### 1. 图片水印缩放
- ✅ 百分比输入来调整图片水印大小
- ✅ 缩放范围：0.1x - 5.0x
- ✅ 实时显示当前缩放倍数

#### 2. 导出文件命名优化
- ✅ **默认前缀**：`wm_`
- ✅ **默认后缀**：`_watermarked`
- ✅ 用户可随时修改默认值

#### 3. OpenCV图片水印优势
- ✅ **高性能**：使用OpenCV进行图片叠加处理
- ✅ **更好的透明度支持**：Alpha通道混合更精确
- ✅ **支持多种输入**：可接受文件路径或PIL Image对象
- ✅ **高质量缩放**：使用LANCZOS4插值算法

#### 4. 界面布局优化
- ✅ 导出设置独立于标签页，所有水印类型共用
- ✅ 图片尺寸调整功能在所有标签页正常工作
- ✅ 更清晰的布局结构

### 技术特性

**文本水印（PIL）**：
- 字体：8种常用字体（Arial, Times New Roman, Courier New, Verdana, 微软雅黑, 宋体, 黑体, 楷体）
- 样式：粗体、斜体、阴影、描边
- 透明度：0-100%
- 旋转：任意角度

**图片水印（OpenCV）**：
- 格式：支持PNG透明通道
- 缩放：0.1x - 5.0x（滑块调节）
- 透明度：0-100%
- 旋转：任意角度
- 位置：九宫格预设 + 自定义拖拽

### 性能优化
- ✅ 批量导出使用多线程，避免界面卡顿
- ✅ OpenCV图片处理速度更快
- ✅ 缩略图使用LANCZOS算法，质量更好


---

## ✅ 已实现功能

### 1. 文件处理

#### 1.1 导入图片
- ✅ **拖拽导入**：直接拖拽图片文件到程序窗口（推荐）✨
- ✅ **选择单张**：选择一张图片导入
- ✅ **批量选择**：一次性选择多张图片导入
- ✅ **选择文件夹**：导入整个文件夹的所有图片
- ✅ **缩略图显示**：图片列表显示50x50像素缩略图和文件名

#### 1.2 支持格式
- ✅ **输入格式**：JPEG (.jpg, .jpeg), PNG (.png), BMP (.bmp), TIFF (.tiff, .tif)
- ✅ **PNG透明通道**：完全支持透明背景
- ✅ **输出格式**：JPEG（适合照片）, PNG（保留透明）

#### 1.3 导出图片
- ✅ **指定输出文件夹**：通过按钮选择（不可手动输入）
- ✅ **防止覆盖原图**：自动检查并警告相同文件夹
- ✅ **导出图片命名**：
  - 保留原文件名
  - 添加自定义前缀（如 `wm_`）
  - 添加自定义后缀（如 `_watermarked`）
- ✅ **JPEG质量调节**：1-100可调（仅JPEG格式显示）
- ✅ **图片尺寸调整**：
  - 按百分比缩放（10%-500%）
  - 按宽度/高度调整
  - 保持宽高比例选项
  - 默认值为原图尺寸

### 2. 水印类型

#### 2.1 文本水印
- ✅ **自定义文本**：支持中文和英文
- ✅ **字体选择**：系统已安装字体（中文字体优先显示）
- ✅ **字体样式**：
  - 粗体（支持Arial、Times New Roman等）
  - 斜体（支持英文字体）
- ✅ **字号调节**：8-200可调
- ✅ **字体颜色**：调色板选择，实时显示颜色值
- ✅ **透明度**：0-100%可调
- ✅ **阴影效果**：增强可读性（可选）
- ✅ **描边效果**：增强对比度（可选）

#### 2.2 图片水印
- ✅ **本地图片选择**：支持PNG、JPEG等格式
- ✅ **PNG透明支持**：完美支持透明Logo
- ✅ **缩放调节**：0.1-5.0倍
- ✅ **透明度调节**：0-100%

### 3. 水印布局与样式

#### 3.1 实时预览
- ✅ 所有调整立即显示效果
- ✅ 点击图片列表切换预览
- ✅ 上一张/下一张快捷按钮

#### 3.2 位置控制
- ✅ **九宫格预设位置**：
  - 左上、上中、右上
  - 左中、中心、右中
  - 左下、下中、右下
- ✅ **手动拖拽定位** ✨
  - 在预览图上直接拖拽水印
  - 实时显示位置变化
  - 精确到像素
  - 💡 提示："可在预览图上拖拽水印"

#### 3.3 旋转
- ✅ 任意角度旋转（-180° 到 180°）

### 4. 配置管理

#### 4.1 水印模板
- ✅ 保存当前设置为模板（包括拖拽位置）
- ✅ 下拉框选择模板自动加载
- ✅ 删除不需要的模板
- ✅ 无模板时显示"暂无模板"提示

#### 4.2 设置持久化
- ✅ 自动保存上次使用的设置
- ✅ 程序启动时恢复设置
- ✅ 一键重置为默认设置

### 5. 界面优化

- ✅ **可调整面板**：拖动分割线调整各面板大小
- ✅ **鼠标滚轮**：水印设置面板支持滚轮滚动
- ✅ **缩略图显示**：50x50像素，清晰可见
- ✅ **颜色预览**：实时显示选择的颜色
- ✅ **智能界面**：JPEG显示质量滑块，PNG自动隐藏

---

## 🔤 字体系统

### 字体来源

程序读取当前Windows系统已安装的字体，只显示能够正确加载的字体。

**查看系统字体**：
- 打开文件夹：`C:\Windows\Fonts`
- 或：控制面板 → 字体

### 字体列表

程序提供8种经过优化的常用字体，确保在所有Windows系统上都能正常使用：

**中文字体**：
- 微软雅黑 - 现代、清晰（推荐）
- 宋体 - 传统、正式
- 黑体 - 醒目、粗重
- 楷体 - 优雅、书法感

**英文字体**：
- Arial - 简洁、现代（推荐）
- Times New Roman - 正式、传统
- Courier New - 等宽、技术感
- Verdana - 清晰、易读

### 字体兼容性

**所有字体在任何Windows电脑上都能使用**：
- 这8种字体是Windows系统自带的标准字体
- 无论Windows 7/8/10/11都包含这些字体
- 模板可以在不同电脑之间完美迁移

**字体选择建议**：
- **中文水印**：微软雅黑（现代感）或黑体（醒目）
- **英文水印**：Arial（通用）或Times New Roman（正式）
- **混合水印**：微软雅黑（支持中英文混排）

---

## 📖 使用指南

见`使用演示.md`

---

## 🎉 功能亮点总结

### 最实用的功能

1. **拖拽导入** ✨ - 最快速的导入方式
2. **拖拽定位** ✨ - 精确控制水印位置
3. **模板系统** - 一次设置，重复使用
4. **批量处理** - 同时处理多张图片
5. **实时预览** - 所见即所得

### 最贴心的设计

1. **防止覆盖原图** - 自动检查并警告
2. **缩略图显示** - 直观查看图片
3. **颜色预览** - 实时显示选择的颜色
4. **智能界面** - 根据选择显示/隐藏选项
5. **鼠标滚轮** - 便捷滚动设置面板

### 最专业的效果

1. **粗体/斜体** - 丰富的字体样式
2. **阴影/描边** - 增强水印可读性
3. **透明度控制** - 精确到1%
4. **任意角度旋转** - 创意水印效果
5. **尺寸调整** - 导出时优化图片大小

---

## 📦 项目文件

```
Photo_Watermark_2/
├── main.py                 # 主程序
├── image_processor.py      # 图片处理
├── text_watermark_manager.py  # 文字水印管理
├── image_watermark_manager.py # 图片水印管理
├── config_manager.py       # 配置管理
├── build_exe.py           # 打包脚本
├── test_app.py            # 测试脚本
├── requirements.txt       # 依赖列表
├── README.md              # 项目说明
├── USAGE.md               # 使用说明
└── config/                # 配置目录
    ├── settings.json      # 用户设置
    └── templates.json     # 水印模板
```

---

## 🚀 开始使用
# 1.
```bash
# 安装依赖
pip install -r requirements.txt

# 运行程序
python main.py

# 现在可以拖拽图片开始使用了！
```
# 2.
运行 `PhotoWatermark2.exe`

**Photo Watermark 2 - 功能完整的专业图片水印工具** 🎉
