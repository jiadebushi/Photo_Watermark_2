# Photo Watermark 2 - 功能清单与使用指南

## 📋 目录
- [最新更新](#最新更新)
- [已实现功能](#已实现功能)
- [拖拽导入](#拖拽导入)
- [字体系统](#字体系统)
- [水印位置拖拽](#水印位置拖拽)
- [颜色选择](#颜色选择)
- [使用指南](#使用指南)

---

## 🆕 最新更新

### 架构重构（使用OpenCV实现图片水印）

**水印管理模块分离**：
- `text_watermark_manager.py` - 文本水印管理（基于PIL）
- `image_watermark_manager.py` - 图片水印管理（基于OpenCV）
- 原有的 `watermark_manager.py` 已不再使用

**新增依赖**：
```bash
pip install opencv-python numpy
```
或使用：
```bash
pip install -r requirements.txt
```

### 功能改进

#### 1. 图片水印缩放
- ✅ 直观的滑块控件来调整图片水印大小
- ✅ 缩放范围：0.1x - 5.0x
- ✅ 实时显示当前缩放倍数（如 `1.0x`）
- ✅ 支持拖动滑块调整

#### 2. 导出文件命名优化
- ✅ **默认前缀**：`wm_`
- ✅ **默认后缀**：`_watermarked`
- ✅ 用户可随时修改默认值

#### 3. OpenCV图片水印优势
- ✅ **高性能**：使用OpenCV进行图片叠加处理
- ✅ **更好的透明度支持**：Alpha通道混合更精确
- ✅ **支持多种输入**：可接受文件路径或PIL Image对象
- ✅ **高质量缩放**：使用LANCZOS4插值算法

#### 4. 界面布局优化
- ✅ 导出设置独立于标签页，所有水印类型共用
- ✅ 图片尺寸调整功能在所有标签页正常工作
- ✅ 更清晰的布局结构

### 技术特性

**文本水印（PIL）**：
- 字体：8种常用字体（Arial, Times New Roman, Courier New, Verdana, 微软雅黑, 宋体, 黑体, 楷体）
- 样式：粗体、斜体、阴影、描边
- 透明度：0-100%
- 旋转：任意角度

**图片水印（OpenCV）**：
- 格式：支持PNG透明通道
- 缩放：0.1x - 5.0x（滑块调节）
- 透明度：0-100%
- 旋转：任意角度
- 位置：九宫格预设 + 自定义拖拽

### 性能优化
- ✅ 批量导出使用多线程，避免界面卡顿
- ✅ OpenCV图片处理速度更快
- ✅ 缩略图使用LANCZOS算法，质量更好


---

## ✅ 已实现功能

### 1. 文件处理

#### 1.1 导入图片
- ✅ **拖拽导入**：直接拖拽图片文件到程序窗口（推荐）✨
- ✅ **选择单张**：选择一张图片导入
- ✅ **批量选择**：一次性选择多张图片导入
- ✅ **选择文件夹**：导入整个文件夹的所有图片
- ✅ **缩略图显示**：图片列表显示50x50像素缩略图和文件名

#### 1.2 支持格式
- ✅ **输入格式**：JPEG (.jpg, .jpeg), PNG (.png), BMP (.bmp), TIFF (.tiff, .tif)
- ✅ **PNG透明通道**：完全支持透明背景
- ✅ **输出格式**：JPEG（适合照片）, PNG（保留透明）

#### 1.3 导出图片
- ✅ **指定输出文件夹**：通过按钮选择（不可手动输入）
- ✅ **防止覆盖原图**：自动检查并警告相同文件夹
- ✅ **导出图片命名**：
  - 保留原文件名
  - 添加自定义前缀（如 `wm_`）
  - 添加自定义后缀（如 `_watermarked`）
- ✅ **JPEG质量调节**：1-100可调（仅JPEG格式显示）
- ✅ **图片尺寸调整**：
  - 按百分比缩放（10%-500%）
  - 按宽度/高度调整
  - 保持宽高比例选项
  - 默认值为原图尺寸

### 2. 水印类型

#### 2.1 文本水印
- ✅ **自定义文本**：支持中文和英文
- ✅ **字体选择**：系统已安装字体（中文字体优先显示）
- ✅ **字体样式**：
  - 粗体（支持Arial、Times New Roman等）
  - 斜体（支持英文字体）
- ✅ **字号调节**：8-200可调
- ✅ **字体颜色**：调色板选择，实时显示颜色值
- ✅ **透明度**：0-100%可调
- ✅ **阴影效果**：增强可读性（可选）
- ✅ **描边效果**：增强对比度（可选）

#### 2.2 图片水印
- ✅ **本地图片选择**：支持PNG、JPEG等格式
- ✅ **PNG透明支持**：完美支持透明Logo
- ✅ **缩放调节**：0.1-5.0倍
- ✅ **透明度调节**：0-100%

### 3. 水印布局与样式

#### 3.1 实时预览
- ✅ 所有调整立即显示效果
- ✅ 点击图片列表切换预览
- ✅ 上一张/下一张快捷按钮

#### 3.2 位置控制
- ✅ **九宫格预设位置**：
  - 左上、上中、右上
  - 左中、中心、右中
  - 左下、下中、右下
- ✅ **手动拖拽定位** ✨
  - 在预览图上直接拖拽水印
  - 实时显示位置变化
  - 精确到像素
  - 💡 提示："可在预览图上拖拽水印"

#### 3.3 旋转
- ✅ 任意角度旋转（-180° 到 180°）

### 4. 配置管理

#### 4.1 水印模板
- ✅ 保存当前设置为模板（包括拖拽位置）
- ✅ 下拉框选择模板自动加载
- ✅ 删除不需要的模板
- ✅ 无模板时显示"暂无模板"提示

#### 4.2 设置持久化
- ✅ 自动保存上次使用的设置
- ✅ 程序启动时恢复设置
- ✅ 一键重置为默认设置

### 5. 界面优化

- ✅ **可调整面板**：拖动分割线调整各面板大小
- ✅ **鼠标滚轮**：水印设置面板支持滚轮滚动
- ✅ **缩略图显示**：50x50像素，清晰可见
- ✅ **颜色预览**：实时显示选择的颜色
- ✅ **智能界面**：JPEG显示质量滑块，PNG自动隐藏

---

## 🎯 拖拽导入

### 使用方法

**最快速的导入方式** - 直接拖拽图片到程序窗口：

1. **单个图片**：从文件夹拖拽一张图片到程序窗口
2. **多个图片**：同时选中多张图片拖拽到程序
3. **支持区域**：整个窗口、图片列表、预览区域都可以

### 特点
- ✅ 支持单个或多个文件同时拖拽
- ✅ 自动过滤非图片文件
- ✅ 支持所有格式（JPEG, PNG, BMP, TIFF）
- ✅ 拖拽成功后状态栏显示导入数量

### 其他导入方式

如果拖拽不可用，还有三种按钮导入方式：
- **选择单张**：选择一张图片
- **批量选择**：一次性选择多张图片
- **选择文件夹**：导入整个文件夹

---

## 🔤 字体系统

### 字体来源

程序读取当前Windows系统已安装的字体，只显示能够正确加载的字体。

**查看系统字体**：
- 打开文件夹：`C:\Windows\Fonts`
- 或：控制面板 → 字体

### 字体列表

程序提供8种经过优化的常用字体，确保在所有Windows系统上都能正常使用：

**中文字体**：
- 微软雅黑 - 现代、清晰（推荐）
- 宋体 - 传统、正式
- 黑体 - 醒目、粗重
- 楷体 - 优雅、书法感

**英文字体**：
- Arial - 简洁、现代（推荐）
- Times New Roman - 正式、传统
- Courier New - 等宽、技术感
- Verdana - 清晰、易读

### 粗体和斜体

**所有字体都支持粗体和斜体** ✨

**实现方式**：
- **英文字体**（如Arial、Times New Roman）：使用真实的粗体/斜体字体文件
- **中文字体**（如宋体、黑体、楷体）：使用模拟效果
  - 粗体：多层文字叠加
  - 斜体：仿射变换倾斜15度

**效果**：
- ✅ 粗体：文字加粗，更醒目
- ✅ 斜体：文字向右倾斜
- ✅ 粗斜体：同时应用两种效果

**使用方法**：
1. 选择任意字体（中文或英文）
2. 勾选"粗体"和/或"斜体"
3. 立即看到效果

**建议**：
- 中文粗体：楷体、宋体配合粗体效果醒目
- 英文粗体：Arial、Times New Roman效果最佳
- 斜体：更适合英文字体

### 字体兼容性

**所有字体在任何Windows电脑上都能使用**：
- 这8种字体是Windows系统自带的标准字体
- 无论Windows 7/8/10/11都包含这些字体
- 模板可以在不同电脑之间完美迁移

**字体选择建议**：
- **中文水印**：微软雅黑（现代感）或黑体（醒目）
- **英文水印**：Arial（通用）或Times New Roman（正式）
- **混合水印**：微软雅黑（支持中英文混排）

---

## 🎯 水印位置拖拽

### 使用方法

**直接在预览图上拖拽水印到任意位置**：

1. 在预览图上点击并按住鼠标左键
2. 拖动到目标位置
3. 释放鼠标，水印固定在新位置
4. 位置自动切换到"自定义（拖拽）"

### 位置模式

**预设位置（9个快捷选项）**：
- 点击九宫格按钮快速定位
- 适合批量处理不同尺寸图片

**自定义位置（拖拽）**：
- 完全自由定位
- 精确到像素
- 适合精确要求的场景

### 批量处理

- 拖拽定位后，所有图片使用相同的像素坐标
- 适合尺寸相同或相近的图片
- 如图片尺寸差异大，建议使用九宫格预设位置

### 保存到模板

- 拖拽的位置会保存到模板中
- 加载模板时自动恢复拖拽位置
- 下次使用时无需重新定位

---

## 🎨 颜色选择

### 使用方法

1. 点击"选择颜色"按钮
2. 在颜色选择器中选择颜色
3. 点击"确定"
4. 程序更新颜色预览和水印

### 颜色显示

- **颜色预览框**：20x20像素的颜色方块
- **颜色值标签**：显示十六进制值（如 #FFFFFF）
- **实时更新**：选择新颜色后立即更新

### 常用颜色值

| 颜色 | 十六进制值 | 适用场景 |
|------|-----------|---------|
| 纯白 | #FFFFFF | 深色背景 |
| 纯黑 | #000000 | 浅色背景 |
| 灰色 | #808080 | 中性背景 |
| 浅灰 | #C0C0C0 | 深色背景（柔和） |
| 深灰 | #404040 | 浅色背景（柔和） |
| 红色 | #FF0000 | 警告、保密标记 |
| 蓝色 | #0000FF | 信息标记 |

### 使用技巧

**白色背景照片**：
- 颜色：黑色 (#000000) 或深灰 (#404040)
- 透明度：80-90%

**深色背景照片**：
- 颜色：白色 (#FFFFFF) 或浅灰 (#C0C0C0)
- 透明度：70-80%

**彩色背景照片**：
- 选择对比色
- 或使用半透明白色/黑色
- 可开启描边或阴影增加可读性

### 注意事项

**关于色盘RGB值显示**：
- 在颜色选择器内移动色盘时，对话框内的RGB值由系统控制显示
- 点击"确定"后，程序会正确获取RGB值并转换为十六进制
- 所有颜色（包括黑白）都能正常选择和应用

---

## 📖 使用指南

### 快速开始

#### 第一步：导入图片
**推荐方式**：拖拽图片到程序窗口
- 从文件夹拖拽单张或多张图片
- 图片列表显示缩略图和文件名

#### 第二步：设置水印
**文本水印**：
1. 输入文本内容（如"© 2024 版权所有"）
2. 选择字体（中文推荐：微软雅黑、黑体；英文推荐：Arial）
3. 调整字号（建议24-48）
4. 选择颜色（深色背景用白色，浅色背景用黑色）
5. 调整透明度（建议70-90%）

**图片水印**：
1. 切换到"图片水印"
2. 点击"选择"按钮选择PNG Logo
3. 调整缩放比例（建议0.1-0.3）
4. 调整透明度（建议80-90%）

#### 第三步：定位水印
**方法1：快速定位**
- 点击九宫格按钮（如"右下"）

**方法2：精确定位**
- 在预览图上点击并拖拽水印到目标位置
- 实时显示效果

#### 第四步：导出图片
1. 点击"选择"按钮选择输出文件夹（建议新建文件夹）
2. 选择命名规则（原名/前缀/后缀）
3. 选择输出格式（JPEG/PNG）
4. 如需调整尺寸，勾选"调整尺寸"
5. 点击"批量导出"或"导出当前"

### 常用场景

#### 场景1：为照片添加版权水印

1. **导入照片**：拖拽照片到程序
2. **设置文本**："© 2024 Your Name"
3. **字体设置**：微软雅黑，30号，白色
4. **透明度**：80%
5. **位置**：右下角
6. **可选**：勾选"阴影"增加可读性
7. **保存模板**："版权水印"
8. **批量导出**：选择输出文件夹，点击"批量导出"

#### 场景2：为产品图添加Logo

1. **导入产品图**：拖拽产品图片
2. **图片水印**：选择透明PNG Logo
3. **缩放**：0.2倍
4. **透明度**：90%
5. **拖拽定位**：在预览图上拖到左上角
6. **导出**：PNG格式保留透明

#### 场景3：批量添加"样品"标记

1. **导入图片**：选择文件夹批量导入
2. **文本**："SAMPLE"
3. **字体**：Arial，粗体，72号
4. **颜色**：红色 (#FF0000)
5. **透明度**：50%
6. **旋转**：-45度
7. **位置**：中心
8. **批量导出**

### 高级功能

#### 尺寸调整

**按百分比**：
- 勾选"调整尺寸"
- 选择"按百分比"
- 输入百分比值（如50表示缩小到50%）

**按宽高**：
- 选择"宽高"
- 输入宽度值
- 勾选"保持比例"，高度自动计算
- 或手动输入宽度和高度

**使用场景**：
- 网页图片：调整到适合网页的尺寸
- 社交媒体：调整到平台要求的尺寸
- 压缩文件：减小文件大小

#### 模板管理

**保存模板**：
1. 调整好所有参数（包括拖拽位置）
2. 输入新模板名称（如"标准版权"）
3. 点击"保存模板"
4. 提示保存成功

**使用模板**：
1. 点击"选择模板"下拉框
2. 选择已保存的模板
3. 自动加载所有设置

**删除模板**：
1. 选择要删除的模板
2. 点击"删除模板"
3. 确认删除

### 使用技巧

#### 技巧1：精确字体调整

**中文水印推荐**：
- 微软雅黑：现代、清晰
- 黑体：醒目、粗重
- 楷体：优雅、书法感

**英文水印推荐**：
- Arial：简洁、现代
- Times New Roman：正式、传统
- Courier New：等宽、技术感

#### 技巧2：水印可读性

**深色背景**：
- 白色文字 + 80%透明度
- 或：浅色文字 + 阴影

**浅色背景**：
- 黑色文字 + 90%透明度
- 或：深色文字 + 描边

**复杂背景**：
- 开启描边（提高对比度）
- 或开启阴影（增加层次）

#### 技巧3：批量处理一致性

1. 用一张照片调试好效果
2. 拖拽定位到满意位置
3. 保存为模板
4. 导入所有照片
5. 加载模板
6. 批量导出（所有照片相同效果）

#### 技巧4：防止覆盖原图

**默认保护**：
- 程序自动检查输出文件夹
- 如与原图片文件夹相同，弹出警告

**建议做法**：
- 为导出图片新建专用文件夹
- 使用前缀或后缀区分文件
- 养成"原图+处理后图片"分开存放的习惯

#### 技巧5：文件命名规则

**保留原名**：
- 输出文件名与原文件相同
- 适合导出到不同文件夹

**添加前缀**：
- 如：`wm_照片.jpg`
- 适合快速识别已加水印的图片

**添加后缀**：
- 如：`照片_watermarked.jpg`
- 更清晰的文件名区分

---

## ⚙️ 导出设置详解

### 输出文件夹

- 点击"选择"按钮选择文件夹
- 不可手动输入，避免路径错误
- 建议新建文件夹存放导出图片

### 输出格式

**JPEG格式**：
- 适合：照片、色彩丰富的图片
- 文件大小：较小
- 质量可调：1-100（推荐90-95）
- 不支持透明

**PNG格式**：
- 适合：需要透明背景的图片、Logo
- 文件大小：较大
- 无损压缩
- 完美支持透明

### 图片尺寸调整

**何时使用**：
- 原图太大，需要压缩
- 需要统一尺寸
- 适配特定平台要求

**按百分比**：
- 简单快速
- 保持宽高比
- 如：50%即缩小到一半

**按宽高**：
- 精确控制尺寸
- 勾选"保持比例"：修改宽度自动计算高度
- 取消"保持比例"：自由设置宽高

---

## 🎓 完整工作流程示例

### 为100张照片添加版权水印

1. **准备**：
   - 将照片放在同一文件夹
   - 新建"导出"文件夹

2. **设置水印**：
   - 拖拽一张照片到程序（预览）
   - 文本："© 2024 摄影师名字"
   - 字体：微软雅黑，32号
   - 颜色：白色 (#FFFFFF)
   - 透明度：80%
   - 阴影：开启
   - 在预览图上拖拽到右下角

3. **保存模板**：
   - 新模板名称："摄影版权"
   - 点击"保存模板"

4. **批量处理**：
   - 点击"选择文件夹"导入所有照片
   - 输出文件夹：选择"导出"文件夹
   - 命名：添加后缀"_copyright"
   - 格式：JPEG，质量：95
   - 点击"批量导出"

5. **完成**：
   - 查看导出结果统计
   - 检查几张图片效果

### 为产品图添加多种水印

**第一批：添加Logo**
1. 导入产品图
2. 选择Logo PNG
3. 拖拽到左上角
4. 导出到"Logo版"文件夹
5. 保存模板"产品Logo"

**第二批：添加网址**
1. 导入"Logo版"的图片
2. 文本："www.example.com"
3. 拖拽到右下角
4. 导出到"完整版"文件夹
5. 保存模板"产品网址"

---

## 💡 常见问题

### Q: 如何快速切换查看不同图片的水印效果？
**A**: 使用"上一张"/"下一张"按钮，或直接点击图片列表。

### Q: 水印位置在不同尺寸图片上不一致怎么办？
**A**: 使用九宫格预设位置（如"右下"），会自动适应不同尺寸。

### Q: 如何确保导出后水印位置与预览一致？
**A**: 程序会自动处理坐标转换，预览效果即最终效果。

### Q: 可以同时使用文本和图片水印吗？
**A**: 分两次处理：第一次添加图片水印并导出，第二次导入结果添加文本水印。

### Q: 如何让水印更清晰？
**A**: 
- 增加字体大小
- 降低透明度
- 开启描边或阴影
- 选择对比色

### Q: 批量导出时间长怎么办？
**A**: 
- 程序使用多线程，尽量不卡顿
- 大图片处理较慢是正常的
- 可以先导出一张测试效果

### Q: 字体列表为什么和其他电脑不一样？
**A**: 字体列表来自系统已安装字体，不同电脑安装的字体不同是正常的。程序只显示可用字体。

### Q: 如何查看系统有哪些字体？
**A**: 
- 打开文件夹：`C:\Windows\Fonts`
- 或通过：控制面板 → 字体

---

## 🎉 功能亮点总结

### 最实用的功能

1. **拖拽导入** ✨ - 最快速的导入方式
2. **拖拽定位** ✨ - 精确控制水印位置
3. **模板系统** - 一次设置，重复使用
4. **批量处理** - 同时处理多张图片
5. **实时预览** - 所见即所得

### 最贴心的设计

1. **防止覆盖原图** - 自动检查并警告
2. **缩略图显示** - 直观查看图片
3. **颜色预览** - 实时显示选择的颜色
4. **智能界面** - 根据选择显示/隐藏选项
5. **鼠标滚轮** - 便捷滚动设置面板

### 最专业的效果

1. **粗体/斜体** - 丰富的字体样式
2. **阴影/描边** - 增强水印可读性
3. **透明度控制** - 精确到1%
4. **任意角度旋转** - 创意水印效果
5. **尺寸调整** - 导出时优化图片大小

---

## 📦 项目文件

```
Photo_Watermark_2/
├── main.py                 # 主程序
├── image_processor.py      # 图片处理
├── watermark_manager.py    # 水印管理
├── config_manager.py       # 配置管理
├── build_exe.py           # 打包脚本
├── test_app.py            # 测试脚本
├── requirements.txt       # 依赖列表
├── README.md              # 项目说明
├── USAGE.md               # 使用说明
└── config/                # 配置目录
    ├── settings.json      # 用户设置
    └── templates.json     # 水印模板
```

---

## 🚀 开始使用

```bash
# 安装依赖
pip install -r requirements.txt

# 运行程序
python main.py

# 现在可以拖拽图片开始使用了！
```

**Photo Watermark 2 - 功能完整的专业图片水印工具** 🎉
