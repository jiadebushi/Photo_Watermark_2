# Photo Watermark 2 - 新功能说明

## ✨ 最新更新

### 1. 系统字体支持修复 ✅

#### 问题修复
- **问题**：选择字体后，预览图上的水印字体不会变化
- **原因**：tkinter获取的字体名称无法直接被PIL识别
- **解决方案**：添加Windows系统字体路径映射

#### 技术实现

程序现在会：
1. 首先尝试直接加载字体名称
2. 如果失败，使用Windows字体文件映射表
3. 从 `C:\Windows\Fonts` 目录加载字体文件

#### 支持的字体映射

| 字体名称 | 字体文件 |
|---------|---------|
| 微软雅黑 / Microsoft YaHei | msyh.ttc |
| 宋体 / SimSun | simsun.ttc |
| 黑体 / SimHei | simhei.ttf |
| 楷体 / KaiTi | simkai.ttf |
| Arial | arial.ttf |
| Times New Roman | times.ttf |
| Courier New | cour.ttf |
| Verdana | verdana.ttf |

#### 使用方法

1. 在字体下拉框中选择任意字体
2. 水印会立即使用该字体显示
3. 支持中文字体和英文字体

### 2. 预览图拖拽水印位置 ✨

#### 功能说明

现在可以在预览图上直接拖拽水印到任意位置！

#### 使用方法

**方法1：鼠标拖拽（推荐）**
1. 在预览图上按住鼠标左键
2. 拖动鼠标到目标位置
3. 释放鼠标，水印固定在新位置

**方法2：选择"自定义（拖拽）"**
1. 在位置设置面板选择"自定义（拖拽）"选项
2. 在预览图上点击并拖拽水印

#### 技术特点

- ✅ **实时预览**：拖拽时立即显示新位置
- ✅ **精确定位**：坐标自动转换，确保导出时位置准确
- ✅ **智能切换**：拖拽时自动切换到"自定义"模式
- ✅ **保持一致**：批量导出时所有图片使用相同的自定义位置

#### 坐标转换

程序会自动处理：
- 预览图的缩放比例
- 画布偏移量
- 原图实际尺寸
- 确保导出时水印位置与预览一致

#### 位置模式

**预设位置（9个）**：
- 左上、上中、右上
- 左中、中心、右中
- 左下、下中、右下

**自定义位置**：
- 通过拖拽设置
- 完全自由定位
- 精确到像素

#### 提示

💡 在预览图区域会显示提示："可在预览图上拖拽水印"

#### 工作流程

1. **导入图片**
2. **设置水印**（文本/字体/颜色等）
3. **拖拽定位**：在预览图上拖拽到合适位置
4. **批量导出**：所有图片使用相同的水印位置

### 3. 完整的字体系统

#### 字体加载优先级

1. **直接加载**：尝试使用字体名称直接加载
2. **映射加载**：使用Windows字体文件映射
3. **默认字体**：依次尝试微软雅黑、宋体、黑体、Arial
4. **备用字体**：如果全部失败，使用PIL默认字体

#### 中文字体优先

字体列表中，中文字体显示在最前面：
- 微软雅黑
- 宋体
- 黑体
- 楷体
- （其他英文字体按字母排序）

## 🎯 使用建议

### 字体选择

1. **中文水印**：推荐使用"微软雅黑"或"黑体"，清晰美观
2. **英文水印**：可选择"Arial"或"Times New Roman"
3. **艺术效果**：尝试"楷体"获得书法效果

### 水印定位

1. **快速定位**：使用九宫格预设位置
2. **精确定位**：拖拽到具体位置
3. **批量一致**：设置好位置后批量导出

### 最佳实践

1. **预览确认**：拖拽定位后，切换几张图片预览效果
2. **保存模板**：满意的设置保存为模板，下次直接使用
3. **字体测试**：不同字体效果不同，多试几个找到最佳效果

## 🔧 故障排除

### 字体显示问题

**问题**：选择字体后仍然显示默认字体

**解决**：
1. 确认系统已安装该字体
2. 重启程序重新加载字体
3. 尝试选择其他字体

**检查系统字体**：
- Windows：打开 `C:\Windows\Fonts` 查看
- 控制面板 > 字体

### 拖拽定位问题

**问题**：拖拽后位置不准确

**解决**：
1. 确保选择了"自定义（拖拽）"模式
2. 在预览图上慢慢拖拽，观察实时变化
3. 如需重置，选择其他预设位置后再拖拽

**问题**：导出后位置与预览不一致

**解决**：
1. 确认使用了自定义位置模式
2. 重新拖拽定位
3. 刷新预览确认效果

## 📊 性能优化

- 字体文件映射减少加载时间
- 拖拽时智能刷新，不影响性能
- 批量导出时复用水印配置

## 🎉 更新总结

这两个功能大大提升了用户体验：

1. **字体支持**：真正实现了字体自由选择
2. **拖拽定位**：所见即所得的水印定位

现在 Photo Watermark 2 提供了专业级的水印定制能力！

