# Photo Watermark 2 - 项目文件说明

## 📁 项目结构

```
Photo_Watermark_2/
├── 📄 核心代码文件
│   ├── main.py                      # 主程序入口，GUI界面
│   ├── text_watermark_manager.py    # 文本水印管理（基于PIL）
│   ├── image_watermark_manager.py   # 图片水印管理（基于OpenCV）
│   ├── image_processor.py           # 图片处理模块
│   └── config_manager.py            # 配置和模板管理
│
├── 📝 文档文件
│   ├── README.md                    # 项目概述和快速开始
│   ├── 使用演示.md                  # 完整使用教程和常见问题 ⭐
│   ├── 功能清单.md                  # 所有功能列表和最新更新 ⭐
│   ├── 安装说明.md                  # 详细安装指南
│   └── 项目文件说明.md              # 本文件，项目结构说明
│
├── 🔧 配置和工具
│   ├── requirements.txt             # Python依赖列表
│   ├── build_exe.py                 # Windows可执行文件构建脚本
│   ├── test_app.py                  # 单元测试
│   └── config/                      # 配置目录
│       ├── settings.json            # 用户设置
│       └── templates.json           # 水印模板
│
└── 📦 其他
    └── __pycache__/                 # Python缓存文件
```

---

## 📄 核心代码文件

### main.py
**主程序入口**

- **功能**：
  - 创建GUI主窗口
  - 管理用户界面布局（分栏、标签页）
  - 处理所有用户交互事件
  - 协调各模块间的数据传递
  - 实现拖拽导入功能

- **关键组件**：
  - `PhotoWatermarkApp` 类：主应用程序
  - 图片列表显示（缩略图 + 文件名）
  - 预览画布和水印拖拽
  - 文本/图片水印两个标签页
  - 导出设置面板

- **依赖**：
  - tkinter (GUI框架)
  - tkinterdnd2 (拖拽支持)
  - PIL/Pillow (图片显示)

### text_watermark_manager.py
**文本水印管理模块**

- **技术栈**：PIL/Pillow
- **功能**：
  - 创建文本水印图层
  - 字体加载和渲染
  - 粗体/斜体效果（真实或模拟）
  - 阴影和描边效果
  - 旋转和透明度控制
  - 水印位置计算

- **支持的字体**：
  - 中文：微软雅黑、宋体、黑体、楷体
  - 英文：Arial、Times New Roman、Courier New、Verdana

- **特性**：
  - 字体文件缓存机制
  - 自动fallback到系统默认字体
  - 支持粗体/斜体变体文件

### image_watermark_manager.py
**图片水印管理模块**

- **技术栈**：OpenCV + NumPy
- **功能**：
  - 加载和处理水印图片
  - PNG透明通道支持
  - Alpha混合算法
  - 高质量缩放（LANCZOS4）
  - 旋转和透明度控制
  - 水印叠加处理

- **优势**：
  - 高性能图片处理
  - 精确的Alpha通道混合
  - 支持文件路径和PIL Image输入
  - 自动添加Alpha通道（如果缺失）

### image_processor.py
**图片处理模块**

- **功能**：
  - 图片导入和格式验证
  - 支持的格式：JPEG、PNG、BMP、TIFF
  - 批量导入和文件夹导入
  - 缩略图生成（150x150）
  - 图片格式转换和导出
  - 图片尺寸调整
  - JPEG质量控制

- **核心方法**：
  - `add_image()` - 添加单张图片
  - `add_images_batch()` - 批量添加
  - `add_images_from_folder()` - 文件夹导入
  - `save_image()` - 保存图片
  - `create_thumbnail()` - 生成缩略图

### config_manager.py
**配置管理模块**

- **功能**：
  - 水印模板的保存/加载/删除
  - 用户设置持久化
  - 默认配置管理
  - 上次使用设置的恢复

- **存储格式**：JSON
- **存储位置**：`config/` 目录
  - `settings.json` - 用户设置
  - `templates.json` - 水印模板


---

## 📝 文档文件

### README.md
**项目概述**

- 项目介绍
- 功能需求
- 技术设计和架构
- 安装和运行说明
- 快速开始指南

**适合人群**：首次了解项目的开发者

### 使用演示.md
**完整使用教程**

- 基础使用教程（导入、设置、导出）
- 完整工作流程（3个实际场景）
- 10个实用技巧
- 效果示例
- 常见问题解答
- 高级应用

**适合人群**：普通用户，想要快速学会使用

### 功能清单.md
**功能列表和更新日志**

- 最新更新和架构重构说明
- 完整的已实现功能清单
- 拖拽导入详细说明
- 字体系统说明
- 水印拖拽功能说明
- 颜色选择说明

**适合人群**：想要了解所有功能的用户

### 安装说明.md
**详细安装指南**

- 架构更新说明
- 环境配置
- 依赖安装（包含OpenCV和NumPy）
- 9个常见安装问题及解决方案
- 验证安装方法
- 打包说明

**适合人群**：初次安装的用户和升级用户

### 项目文件说明.md
**项目结构文档（本文件）**

- 完整的文件结构说明
- 每个文件的详细用途
- 文件必需性标注
- 快速导航指南
- 版本历史

**适合人群**：开发者和贡献者

---

## 🔧 配置和工具

### requirements.txt
**Python依赖列表**

```
Pillow>=9.0.0           # 图像处理（文本水印）
opencv-python>=4.8.0    # 图像处理（图片水印）
numpy>=1.24.0           # 数值计算
pyinstaller>=5.0.0      # 打包工具
tkinterdnd2>=0.3.0      # 拖拽支持
```

**安装命令**：
```bash
pip install -r requirements.txt
```

### build_exe.py
**Windows可执行文件构建脚本**

- 使用PyInstaller打包
- 生成单文件.exe版本
- 生成便携版本文件夹
- 包含所有依赖和资源

**使用方法**：
```bash
python build_exe.py
```

### test_app.py
**单元测试脚本**

- 测试核心模块功能
- 验证配置管理
- 测试图片处理

**运行测试**：
```bash
python test_app.py
```

### config/ 目录
**配置文件存储**

- `settings.json` - 保存用户最后使用的设置
- `templates.json` - 保存所有水印模板
- 自动创建，无需手动配置

---

## 🗂️ 文件用途速查

| 文件 | 用途 | 是否必需 |
|------|------|---------|
| `main.py` | 主程序 | ✅ 必需 |
| `text_watermark_manager.py` | 文本水印 | ✅ 必需 |
| `image_watermark_manager.py` | 图片水印 | ✅ 必需 |
| `image_processor.py` | 图片处理 | ✅ 必需 |
| `config_manager.py` | 配置管理 | ✅ 必需 |
| `requirements.txt` | 依赖列表 | ✅ 必需 |
| `README.md` | 项目说明 | 📖 推荐 |
| `使用演示.md` | 使用教程 | 📖 推荐 |
| `功能清单.md` | 功能列表 | 📖 推荐 |
| `安装说明.md` | 安装指南 | 📖 推荐 |
| `项目文件说明.md` | 文件说明 | 📖 推荐 |
| `build_exe.py` | 打包脚本 | 🔧 打包时需要 |
| `test_app.py` | 测试脚本 | 🔧 开发时推荐 |

---

## 🚀 快速导航

### 我想要...

- **快速开始使用** → 查看 `使用演示.md` 的"基础使用教程"部分
- **了解所有功能** → 查看 `功能清单.md`（含最新更新）
- **解决使用问题** → 查看 `使用演示.md` 的"常见问题"部分
- **安装或升级程序** → 查看 `安装说明.md`
- **了解项目结构** → 查看 `项目文件说明.md`（本文件）
- **开发和修改** → 查看 `README.md` 的"技术设计"部分
- **打包程序** → 运行 `build_exe.py`

### 我是...

- **普通用户** → 阅读：`使用演示.md`
- **开发者** → 阅读：`README.md` + 代码注释
- **贡献者** → 阅读：所有.md文件 + 运行 `test_app.py`

---

## 📌 重要提示

1. **不要删除的文件**：
   - 所有 `.py` 文件
   - `requirements.txt`
   - `config/` 目录

2. **可以删除的文件**：
   - `__pycache__/` - 缓存文件，会自动重新生成

3. **自动生成的文件**：
   - `config/settings.json` - 首次运行时创建
   - `config/templates.json` - 保存模板时创建
   - `__pycache__/` - Python自动生成

4. **文档文件**：
   - 中文文档：方便国内用户
   - 可以根据需要保留或删除
   - 不影响程序运行

---

## 🔄 版本历史

### v1.0 - 初始版本
- ✅ 基础文本水印
- ✅ 基础图片水印
- ✅ 拖拽导入
- ✅ 模板管理
- ✅ OpenCV图片水印支持
- ✅ 文本和图片水印模块分离
- ✅ 优化UI布局
- ✅ 添加缩放滑块
- ✅ 改进默认设置

---

## 📞 支持

如有问题，请：
1. 查看 `安装说明.md` 解决安装问题
2. 查看 `使用演示.md` 中的常见问题
3. 查看 `功能清单.md` 了解最新更新
4. 运行 `test_app.py` 检查环境

---

## 📋 文档更新日志

**更新**（最新）：
- ✅ 新增`项目文件说明.md` - 完整的文件结构说明
- ✅ 更新`安装说明.md` - 添加OpenCV和NumPy安装说明
- ✅ 更新`使用演示.md` - 合并快速开始教程和常见问题
- ✅ 更新`功能清单.md` - 添加最新更新章节
- ✅ 更新`README.md` - 更新架构设计
- ❌ 删除`USAGE.md` - 内容已合并到使用演示.md
- ❌ 删除`快速开始.md` - 内容已合并到使用演示.md
- ❌ 删除`更新说明.md` - 内容已合并到功能清单.md
- ❌ 删除`布局修复说明.md` - 技术细节，用户不需要

**文档精简**：从8个文档精简到5个核心文档，内容更集中，查找更方便。

